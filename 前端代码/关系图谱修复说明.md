# 关系图谱显示修复说明

## 问题描述

详情页面中缺少关系图谱的显示功能，无法可视化展示故障原因、现象和解决方案之间的关系。

## 解决方案

在 `answerReason_detail.html` 详情页面中添加了完整的关系图谱显示功能。

### 添加的功能

1. **引入 ECharts 库**
   - 在页面底部引入 `echarts.min.js`，用于绘制关系图谱

2. **添加关系图谱容器**
   - 在页面中添加了关系图谱的显示区域
   - 包括图例（Legend）和图表容器

3. **实现图谱绘制逻辑**
   - 从数据中的 `list` 字段提取节点和关系信息
   - 使用 ECharts 的 graph 图表类型绘制关系图谱
   - 支持节点拖拽和缩放（roam 功能）

### 修改的文件

**`html/answerReason_detail.html`**

#### 1. HTML 结构

添加了关系图谱的容器：

```html
<!-- 关系图谱 -->
<div id="graphContainer" style="display: none;">
  <h4 style="margin-bottom: 10px;">关系图谱</h4>
  <div id="graphLegend"></div>
  <div id="graphChart"></div>
</div>
```

#### 2. CSS 样式

添加了关系图谱相关的样式：

- `#graphContainer` - 图谱容器样式
- `#graphLegend` - 图例容器样式
- `.legend-item` - 图例项样式
- `.legend-color` - 图例颜色块样式
- `#graphChart` - 图表容器样式

#### 3. JavaScript 功能

添加了以下函数：

- `renderGraph(listData)` - 渲染关系图谱的主要函数
- `getColorByType(type)` - 根据节点类型获取对应的颜色

### 图谱特性

1. **节点类型颜色映射**：
   - 品牌：#CC0000（红色）
   - 型号：#CC66FF（紫色）
   - 故障代码：#99CCFF（浅蓝色）
   - 故障类型：#97980e（橄榄绿）
   - 解决方法：#888888（灰色）
   - 故障描述：#FA8072（浅红色）
   - 间接原因：#99CCFF（浅蓝色）
   - 最终原因：#99CCFF（浅蓝色）

2. **图例显示**：
   - 自动显示所有出现的节点类型
   - 使用颜色块标识不同类型

3. **交互功能**：
   - 支持拖拽移动节点
   - 支持鼠标滚轮缩放
   - 鼠标悬停显示完整节点名称
   - 点击节点高亮相关连接

4. **布局方式**：
   - 使用预设位置数组布局节点
   - 支持手动拖拽调整位置
   - 自动计算连接关系

### 数据处理逻辑

1. **节点去重**：确保每个节点只添加一次
2. **名称截断**：如果节点名称超过 9 个字符，显示时截取前 9 个字符并加 "..."
3. **完整名称显示**：在 tooltip 中显示完整节点名称
4. **关系连接**：根据 `list` 中的关系数据自动绘制连接线

### 使用方式

当详情页面的数据中包含 `list` 字段时，关系图谱会自动显示：

```javascript
if (data.list && Array.isArray(data.list) && data.list.length > 0) {
  document.getElementById('graphContainer').style.display = 'block';
  renderGraph(data.list);
}
```

### 数据格式要求

关系图谱需要 `list` 字段包含以下格式的数据：

```javascript
[
  {
    "entity1": "节点1名称",
    "rel": "关系类型",
    "entity2": "节点2名称",
    "entity1_type": "节点1类型",
    "entity2_type": "节点2类型"
  },
  // ... 更多关系数据
]
```

### 注意事项

1. **ECharts 版本**：确保使用的是兼容的 ECharts 版本
2. **容器尺寸**：图表容器需要有固定的高度（400px）
3. **响应式**：图表会自动响应窗口大小变化
4. **性能**：当节点数量很多时，可能需要优化布局算法

### 测试建议

1. 测试数据中有 `list` 字段的情况
2. 测试数据中没有 `list` 字段的情况（应该不显示图谱）
3. 测试节点数量较多的情况
4. 测试拖拽和缩放功能
5. 测试不同浏览器兼容性

## 下一步优化（可选）

1. **使用力导向布局**：改用 ECharts 的力导向布局，让节点自动排列
2. **优化节点位置**：根据节点关系自动计算最佳位置
3. **添加动画效果**：节点出现时的动画效果
4. **导出功能**：允许导出图谱为图片


